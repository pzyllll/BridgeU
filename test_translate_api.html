<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•ç¿»è¯‘ API</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        .info {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            border-left: 4px solid #2196f3;
        }
        input, button {
            padding: 0.5rem;
            margin: 0.5rem 0;
            font-size: 1rem;
        }
        input {
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #1976d2; }
        .result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success { background: #e8f5e9; border-left: 4px solid #4caf50; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª æµ‹è¯•ç¿»è¯‘ API</h1>
        
        <div class="info">
            <strong>è¯´æ˜ï¼š</strong> æµ‹è¯•åç«¯ç¿»è¯‘ API æ˜¯å¦æ­£å¸¸å·¥ä½œ
        </div>

        <div>
            <label>å¸–å­ ID:</label>
            <input type="text" id="postId" placeholder="è¾“å…¥è¦ç¿»è¯‘çš„å¸–å­ ID">
        </div>

        <div>
            <label>Token (å¯é€‰ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™):</label>
            <input type="text" id="token" placeholder="è¾“å…¥ JWT Token">
        </div>

        <button onclick="testTranslate()">æµ‹è¯•ç¿»è¯‘</button>
        <button onclick="testGetPosts()">è·å–å¸–å­åˆ—è¡¨ï¼ˆæŸ¥æ‰¾æ³°è¯­å¸–å­ï¼‰</button>

        <div id="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';

        async function testTranslate() {
            const postId = document.getElementById('postId').value;
            const token = document.getElementById('token').value;
            const resultDiv = document.getElementById('result');

            if (!postId) {
                resultDiv.innerHTML = '<div class="result error">è¯·è¾“å…¥å¸–å­ ID</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="result">æ­£åœ¨ç¿»è¯‘...</div>';

            try {
                const headers = {
                    'Content-Type': 'application/json'
                };
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch(`${API_BASE}/admin/posts/${postId}/translate`, {
                    method: 'POST',
                    headers: headers
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            âœ… ç¿»è¯‘æˆåŠŸï¼<br><br>
                            ${JSON.stringify(data, null, 2)}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            âŒ ç¿»è¯‘å¤±è´¥ (${response.status})<br><br>
                            ${JSON.stringify(data, null, 2)}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        âŒ è¯·æ±‚å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }

        async function testGetPosts() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="result">æ­£åœ¨è·å–å¸–å­åˆ—è¡¨...</div>';

            try {
                const response = await fetch(`${API_BASE}/posts?lang=zh`);
                const posts = await response.json();

                // æŸ¥æ‰¾æ³°è¯­å¸–å­
                const thaiPosts = posts.filter(post => {
                    const hasThaiChars = /[à¸-à¹™]/.test(post.title || '');
                    const needsTranslation = 
                        !post.titleZh || !post.titleEn || 
                        !post.contentZh || !post.contentEn;
                    return hasThaiChars && needsTranslation;
                });

                if (thaiPosts.length === 0) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            âœ… æ²¡æœ‰æ‰¾åˆ°éœ€è¦ç¿»è¯‘çš„æ³°è¯­å¸–å­<br><br>
                            æ€»å¸–å­æ•°: ${posts.length}
                        </div>
                    `;
                } else {
                    let html = `
                        <div class="result">
                            <strong>æ‰¾åˆ° ${thaiPosts.length} ä¸ªéœ€è¦ç¿»è¯‘çš„æ³°è¯­å¸–å­:</strong><br><br>
                    `;
                    thaiPosts.slice(0, 10).forEach(post => {
                        const missing = [];
                        if (!post.titleZh) missing.push('ä¸­æ–‡æ ‡é¢˜');
                        if (!post.titleEn) missing.push('è‹±æ–‡æ ‡é¢˜');
                        if (!post.contentZh) missing.push('ä¸­æ–‡å†…å®¹');
                        if (!post.contentEn) missing.push('è‹±æ–‡å†…å®¹');
                        
                        html += `
                            <div style="margin: 1rem 0; padding: 0.5rem; background: #f5f5f5; border-radius: 4px;">
                                <strong>ID:</strong> ${post.id}<br>
                                <strong>æ ‡é¢˜:</strong> ${post.title.substring(0, 50)}...<br>
                                <strong>ç¼ºå¤±ç¿»è¯‘:</strong> ${missing.join(', ')}<br>
                                <button onclick="document.getElementById('postId').value='${post.id}'; testTranslate();" 
                                        style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; font-size: 0.875rem;">
                                    ç¿»è¯‘æ­¤å¸–å­
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                    resultDiv.innerHTML = html;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        âŒ è·å–å¸–å­åˆ—è¡¨å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>

